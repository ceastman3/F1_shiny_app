---
title: "Homework 4"
author: "Connor Eastman"
date: "2024-04-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# kaggle datasets download -d rohanrao/formula-1-world-championship-1950-2020
# install.packages("shiny", "shinyWidgets")
library(shiny)
library(shinyWidgets)
library(tidyverse)
library(ggplot2)
library(leaflet)
```

# Formula 1 2023 Season Statistics Visualization

Data Collected from Kaggle dataset [Formula 1 World Championship (1950-2023)](https://www.kaggle.com/datasets/rohanrao/formula-1-world-championship-1950-2020?resource=download)
Headshots [Here](https://www.skysports.com/f1/drivers-teams)

```{r}
drivers = read.csv("./data/drivers.csv")

races = read.csv("./data/races.csv")
races = races |>
  filter(races$year == 2023) |>
  select("raceId", "year", "round", "circuitId", "name", "date")

constructors = read.csv("./data/constructors.csv")
circuits = read.csv("./data/circuits.csv")
results = read.csv("./data/results.csv")
constructor_standings = read.csv("./data/constructor_standings.csv")
constructor_standings = constructor_standings |>
  filter(raceId >= 1098)

results = results |>
  filter(results$raceId >= 1098)

races = left_join(races, circuits, by="circuitId") |>
  rename(
    race_name = name.x,
    circuit_name = name.y
  ) |>
  select(-alt, -url)


results = left_join(results, drivers, by="driverId") |>
  rename( driver_num = number.y ) |>
  select(-number.x, -url)

constructor_standings = left_join(constructor_standings, 
                                  constructors, 
                                  by="constructorId") |>
  select(-positionText, -url, -constructorStandingsId)

# Get 2023 Season Drivers
drivers_2023 = unique(results$driverId)
drivers = drivers |>
  filter(driverId %in% drivers_2023)

circuits_2023 = unique(races$circuitId)
circuits = circuits |>
  filter(circuitId %in% circuits_2023) |>
  select(-url)


head(constructor_standings)
```

```{r}
drivers_2023
```


```{r}
ui = fluidPage(
  titlePanel(
    # img(src="f1_logo.png", align="left"),
    h1("Formula 1 2023 Season Driver Statistics", style={'color:white; background-color:#FF1E00'})
    ),
  sidebarLayout(
    sidebarPanel(
      selectInput("surname", "Surname", drivers$surname),
      selectInput("circuit", "Circuit", circuits$name)
    ),
    mainPanel(
      leafletOutput("map"), 
      # plotOutput("team_stats"),
      setBackgroundColor("#FF1E00")
    )
  )
)

server = function(input, output) {
   output$map <- renderLeaflet({
    leaflet(data=circuits) |>
      addTiles() |>
      setView(lng = 0, lat = 0, zoom = 2) |>
      addMarkers(popup=~paste("<b>Circuit:</b>", name, 
                              "<br><b>City:</b>", location, 
                              "<br><b>Country:</b>", country))
  })
}

shinyApp(ui, server)
```


```{r}

for(i in 1:nrow(circuits)) {
        # addMarkers(lng = circuits$lng[i], lat = circuits$lat[i], popup = circuits$name[i])
    # sprintf("%s: (%.2f, %.2f)", circuits$name[i], circuits$lat[i], circuits$lng[i])
  print(circuits$name[i])
}

```

